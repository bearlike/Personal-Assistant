# syntax=docker/dockerfile:1

# Dockerfile.base
FROM python:3.11-slim-bookworm

# Set the title, GitHub repo URL, version, and author
ARG TITLE="Meeseeks Base" \
    VERSION="0.0.7" \
    AUTHOR="Krishnakanth Alagiri" \
    GITHUB_REPO_URL="https://github.com/bearlike/Assistant"

LABEL org.opencontainers.image.source="https://github.com/bearlike/Assistant" \
    org.opencontainers.image.version=$VERSION \
    org.opencontainers.image.vendor=$AUTHOR \
    org.opencontainers.image.licenses="mail@kanth.tech" \
    org.opencontainers.image.licenses="MIT"

LABEL maintainer=$AUTHOR \
    title=$TITLE \
    url=$GITHUB_REPO_URL \
    version=$VERSION

# Update and install necessary software
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    software-properties-common \
    git \
    && rm -rf /var/lib/apt/lists/*

# Set the working directory to /app (assuming project root)
WORKDIR /app

# Copy the repo contents to the Docker image
COPY . /app

# Install uv (no pip cache)
RUN pip install --no-cache-dir uv

# Install the core dependencies (drop uv cache afterwards)
RUN uv pip install --system -e packages/meeseeks_core -e packages/meeseeks_tools \
    && rm -rf /root/.cache/uv

# Set default environment variables for Meeseeks (common ones)
ENV CACHE_DIR='/tmp/meeseeks_cache' \
    DEFAULT_MODEL='gpt-5.2' \
    LOG_LEVEL=DEBUG \
    ENVMODE=dev \
    VERSION=${VERSION} \
    COLOREDLOGS_FIELD_STYLES='asctime=color=240;name=45,inverse' \
    COLOREDLOGS_LEVEL_STYLES='info=220;spam=22;debug=34;verbose=34;notice=220;warning=202;success=118,bold;error=124;critical=background=red' \
    COLOREDLOGS_LOG_FORMAT='%(asctime)s [%(name)s] %(levelname)s %(message)s'
